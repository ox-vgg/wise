# Grammar of Audiovisual Search

Audiovisual search is the process of searching a collection of images,
audio and video using a search engine capable of searching through the
visual content in images and video as well as the audible content in
video and audio. Such a search engine can be queried using text in
natural language or any audiovisual content as a search
query. Furthermore, the search operation can also take into account
the text metadata (e.g. year) associated with each audiovisual
content.

In this document, we develop a grammar that enables specification of
search query for any audiovisual search engine. We use the term
**audiovisual search grammar** to refer to this grammar whose rules
are shown below. The rules have been been numbered to referencing
purpose in the examples shown in the next section.

```
1.  SEARCH -> SEARCH SET_OP SEARCH
2.         |  QUERY IN INDEX
3.         |  ( SEARCH )

4.  SET_OP -> AND
5.         |  OR
6.         |  DIFF

7.  QUERY  -> QUERY VEC_OP QUERY
8.         |  TEXT
9.         |  INTERNAL_ID
10.        |  EXTERNAL_FILE_URL

11. VEC_OP -> ADD
12.        |  SUB

13. INDEX  -> IMAGE
14.        |  AUDIO
15.        |  VIDEO
16.        |  METADATA

17. IMAGE    -> {x : x is a search index of images}
18. AUDIO    -> {x : x is a search index of audio segments}
19. VIDEO    -> {x : x is a search index of video segments}
20. METADATA -> {x : x is a search index of text metadata}

21. TEXT     -> {x : x is a sequence of search query unicode tokens}
22. INTERNAL_ID       -> {x : x is an id of a search index item}
23. EXTERNAL_FILE_URL -> {x : x is a local file path or remote url}
```

## Sentences Generated by the Audiovisual Search Grammar

Here are some examples of the sentences generated by the audiovisual
search grammar.

### 1. SEARCH "cooking" IN VIDEO AND "singing" IN AUDIO

This sentence is generated using a sequence of rules shown below.

```
|------+-------------------------------------------|
| Rule | Generated Sentence                        |
|------+-------------------------------------------|
|      | SEARCH                                    |
|    1 | SEARCH SET_OP SEARCH                      |
|    4 | SEARCH AND SEARCH                         |
|    2 | QUERY IN INDEX AND SEARCH                 |
|    8 | TEXT IN INDEX AND SEARCH                  |
|   21 | "cooking" IN INDEX AND SEARCH             |
|   15 | "cooking" in VIDEO AND SEARCH             |
|    2 | "cooking" in VIDEO AND TEXT IN INDEX      |
|   21 | "cooking" in VIDEO AND "singing" IN INDEX |
|   14 | "cooking" in VIDEO AND "singing" IN AUDIO |
|------+-------------------------------------------|
```

### 2. SEARCH "cooking" IN VIDEO AND "singing" IN AUDIO AND "year=[2012-2022]" in METADATA

This sentence can be generated in a way similar to the sentence
generated in [1]. The `METADATA` search index is commonly implemented
using a full text search engine which interprets "year=[2012-2022]" as
a filter expression on the SQL table column named "year" as a result
only the media that have been tagged as belonging to year 2012, 2013,
... and 2022 are returned in the search result.

### 3. SEARCH dog.jpg ADD "in snow" IN IMAGE

An image of a dog can be combined with the text query `in snow` to
show all images showing dog in snow. This search query requires a
vector space operation of addition on embeddings generated from an
external file `dog.jpg` and a search query term `in snow`. This search
query can be generated using the sequence of rules shown below.

```
|-------+-----------------------------------|
|  Rule | Generated Sentence                |
|-------+-----------------------------------|
|       | SEARCH                            |
|     2 | QUERY IN INDEX                    |
|     7 | QUERY VEC_OP QUERY IN INDEX       |
| 10,23 | dog.jpg VEC_OP QUERY IN INDEX     |
|  8,21 | dog.jpg VEC_OP "in snow" IN INDEX |
|    11 | dog.jpg ADD "in snow" IN INDEX    |
|    13 | dog.jpg ADD "in snow" IN IMAGE    |
|-------+-----------------------------------|
```

### 4. SEARCH "animal" SUB cat.jpg IN IMAGE

This search query can show images containing all different types of
animals except a cat. This search query (or sentence) can be generated
in a way similar to the sentence [3].

### 5. SEARCH "loud" IN VIDEO

The concept of loudness is easy to understand when considering audio
content.  However, how is this concept depicted in visual medium? An
audiovisual search engine operating on a large scale collection of
videos can help us get an answer to this question using this search
query. This sentence is generated by the audiovisual grammar using a
sequence of rules shown below.

```
|------+--------------------|
| Rule | Generated Sentence |
|------+--------------------|
|      | SEARCH             |
|    2 | QUERY IN INDEX     |
| 8,21 | "loud" IN INDEX    |
|   15 | "loud" IN VIDEO    |
|------+--------------------|
```
